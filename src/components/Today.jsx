/* eslint-disable react/no-unescaped-entities */
import { useEffect, useState } from "react"
import { Link } from "react-router-dom";
import { fetchProducts } from "../services/Api";
import "../assets/styles/Today.css";

export default function Today() {
    const isURL = (str) => /^(https?:\/\/)/.test(str);
    const getImageSource = (imagePath) => {
        return isURL(imagePath) ? imagePath : `${import.meta.env.BASE_URL}assets/images/${imagePath}.png`;
    };
    const [currentPage, setCurrentPage] = useState(1);
    const productsPerPage = 4;
    const [products, setProducts] = useState([]);
    const [animationClass, setAnimationClass] = useState("");

    useEffect(() => {
        const getProducts = async () => {
            try {
                const productsData = await fetchProducts();
                setProducts(productsData);
                console.log("Products:", productsData);
            } catch (error) {
                console.error("Error fetching products:", error);
            }
        };
        getProducts();
    }, []);

    const handlePageChange = (newPage) => {
        setAnimationClass("fade-out");
        setTimeout(() => {
            setCurrentPage(newPage);
            setAnimationClass("fade-in");
        }, 300);
    };

    const indexOfFirstProduct = currentPage * productsPerPage - productsPerPage;
    const indexOfLastProduct = currentPage * productsPerPage;
    const currentProducts = products.slice(indexOfFirstProduct, indexOfLastProduct);
    return (
        <div>
            <div className="today container-fluid">
                <div className="container d-flex flex-column gap-5 pb-5 border-bottom border-2">
                    <div className="today-head d-flex align-items-center gap-4 flex-wrap">
                        <svg width="20" height="40" viewBox="0 0 20 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect width="20" height="40" rx="4" fill="#DB4444" />
                        </svg>
                        <h3 className="text-danger fs-4">Today's</h3>
                    </div>
                    <div className="d-flex align-items-center flex-wrap">
                        <h4 className="text-capitalize text-black col-md-3 col-12 text-center text-md-start fs-2">flash sales</h4>
                        <div className="d-flex align-items-center col-md-6 col-12 gap-3 justify-content-center">
                            <div className="d-flex flex-column">
                                <h4 className="fs-6 mb-0">Days</h4>
                                <h5 className="fs-2 fw-bold">03</h5>
                            </div>
                            <p className="text-danger fw-semibold fs-4">:</p>
                            <div className="d-flex flex-column">
                                <h4 className="fs-6 mb-0">Hours</h4>
                                <h5 className="fs-2 fw-bold">23</h5>
                            </div>
                            <p className="text-danger fw-semibold fs-4">:</p>
                            <div className="d-flex flex-column">
                                <h4 className="fs-6 mb-0">Minutes</h4>
                                <h5 className="fs-2 fw-bold">19</h5>
                            </div>
                            <p className="text-danger fw-semibold fs-4">:</p>
                            <div className="d-flex flex-column">
                                <h4 className="fs-6 mb-0">Seconds</h4>
                                <h5 className="fs-2 fw-bold">56</h5>
                            </div>
                        </div>
                        <div className="d-flex justify-content-center gap-2 col-md-3 col-12 mt-3 mt-md-0">
                            <button onClick={() => handlePageChange(currentPage - 1)} disabled={currentPage === 1} className="border-0 bg-transparent pagination-button"><svg width="46" height="46" viewBox="0 0 46 46" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="23" cy="23" r="23" fill="#F5F5F5" />
                                <path d="M22 16L15 23L22 30M15 23H31" stroke="black" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                            </svg></button>
                            <button onClick={() => handlePageChange(currentPage + 1)} disabled={indexOfLastProduct >= products.length} className="border-0 bg-transparent pagination-button"><svg width="46" height="46" viewBox="0 0 46 46" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="23" cy="23" r="23" fill="#F5F5F5" />
                                <path d="M14.5 23H31M31 23L24 16M31 23L24 30" stroke="black" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" />
                            </svg></button>
                        </div>
                    </div>
                    <div className={`product-container ${animationClass}`} onAnimationEnd={() => setAnimationClass("")}>
                        <div className="row">
                            {currentProducts.map((product) => {
                                return (
                                    <div key={product.id} className="product-card col-sm-3">
                                        <picture className="product-pic mb-2 bg-body-tertiary px-4 py-3"><img src={getImageSource(product.imageName)} className="img-fluid" alt="image" /></picture>
                                        <h4 className="text-capitalize fs-5">{product.name}</h4>
                                        {product.discountTag === true ?
                                            <div className="d-flex">
                                                <p className="text-danger fs-5 fw-bold">${product.originalPrice}</p>
                                                <p className="text-muted fs-6 ms-3 text-decoration-line-through">${product.thenPrice}</p>
                                            </div>
                                            : <p className="text-danger fs-5 fw-bold">${product.originalPrice}</p>}
                                        <div className="d-flex">
                                            {product.stars >= 5 ?
                                                <div className="d-flex"> <svg width="100" height="20" viewBox="0 0 100 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M16.673 10.1717C17.7437 9.36184 17.1709 7.65517 15.8284 7.65517H13.3992C12.7853 7.65517 12.243 7.25521 12.0617 6.66868L11.3375 4.32637C10.9309 3.01106 9.0691 3.01106 8.66246 4.32637L7.93832 6.66868C7.75699 7.25521 7.21469 7.65517 6.60078 7.65517H4.12961C2.79142 7.65517 2.21592 9.35274 3.27822 10.1665L5.39469 11.7879C5.85885 12.1435 6.05314 12.7501 5.88196 13.3092L5.11296 15.8207C4.71416 17.1232 6.22167 18.1704 7.30301 17.342L9.14861 15.9281C9.65097 15.5432 10.349 15.5432 10.8514 15.9281L12.6807 17.3295C13.7636 18.159 15.2725 17.1079 14.8696 15.8046L14.09 13.2827C13.9159 12.7198 14.113 12.1081 14.5829 11.7526L16.673 10.1717Z" fill="#FFAD33" />
                                                    <path d="M36.673 10.1717C37.7437 9.36184 37.1709 7.65517 35.8284 7.65517H33.3992C32.7853 7.65517 32.243 7.25521 32.0617 6.66868L31.3375 4.32637C30.9309 3.01106 29.0691 3.01106 28.6625 4.32637L27.9383 6.66868C27.757 7.25521 27.2147 7.65517 26.6008 7.65517H24.1296C22.7914 7.65517 22.2159 9.35274 23.2782 10.1665L25.3947 11.7879C25.8588 12.1435 26.0531 12.7501 25.882 13.3092L25.113 15.8207C24.7142 17.1232 26.2217 18.1704 27.303 17.342L29.1486 15.9281C29.651 15.5432 30.349 15.5432 30.8514 15.9281L32.6807 17.3295C33.7636 18.159 35.2725 17.1079 34.8696 15.8046L34.09 13.2827C33.9159 12.7198 34.113 12.1081 34.5829 11.7526L36.673 10.1717Z" fill="#FFAD33" />
                                                    <path d="M56.673 10.1717C57.7437 9.36184 57.1709 7.65517 55.8284 7.65517H53.3992C52.7853 7.65517 52.243 7.25521 52.0617 6.66868L51.3375 4.32637C50.9309 3.01106 49.0691 3.01106 48.6625 4.32637L47.9383 6.66868C47.757 7.25521 47.2147 7.65517 46.6008 7.65517H44.1296C42.7914 7.65517 42.2159 9.35274 43.2782 10.1665L45.3947 11.7879C45.8588 12.1435 46.0531 12.7501 45.882 13.3092L45.113 15.8207C44.7142 17.1232 46.2217 18.1704 47.303 17.342L49.1486 15.9281C49.651 15.5432 50.349 15.5432 50.8514 15.9281L52.6807 17.3295C53.7636 18.159 55.2725 17.1079 54.8696 15.8046L54.09 13.2827C53.9159 12.7198 54.113 12.1081 54.5829 11.7526L56.673 10.1717Z" fill="#FFAD33" />
                                                    <path d="M76.673 10.1717C77.7437 9.36184 77.1709 7.65517 75.8284 7.65517H73.3992C72.7853 7.65517 72.243 7.25521 72.0617 6.66868L71.3375 4.32637C70.9309 3.01106 69.0691 3.01106 68.6625 4.32637L67.9383 6.66868C67.757 7.25521 67.2147 7.65517 66.6008 7.65517H64.1296C62.7914 7.65517 62.2159 9.35274 63.2782 10.1665L65.3947 11.7879C65.8588 12.1435 66.0531 12.7501 65.882 13.3092L65.113 15.8207C64.7142 17.1232 66.2217 18.1704 67.303 17.342L69.1486 15.9281C69.651 15.5432 70.349 15.5432 70.8514 15.9281L72.6807 17.3295C73.7636 18.159 75.2725 17.1079 74.8696 15.8046L74.09 13.2827C73.9159 12.7198 74.113 12.1081 74.5829 11.7526L76.673 10.1717Z" fill="#FFAD33" />
                                                    <path d="M96.673 10.1717C97.7437 9.36184 97.1709 7.65517 95.8284 7.65517H93.3992C92.7853 7.65517 92.243 7.25521 92.0617 6.66868L91.3375 4.32637C90.9309 3.01106 89.0691 3.01106 88.6625 4.32637L87.9383 6.66868C87.757 7.25521 87.2147 7.65517 86.6008 7.65517H84.1296C82.7914 7.65517 82.2159 9.35274 83.2782 10.1665L85.3947 11.7879C85.8588 12.1435 86.0531 12.7501 85.882 13.3092L85.113 15.8207C84.7142 17.1232 86.2217 18.1704 87.303 17.342L89.1486 15.9281C89.651 15.5432 90.349 15.5432 90.8514 15.9281L92.6807 17.3295C93.7636 18.159 95.2725 17.1079 94.8696 15.8046L94.09 13.2827C93.9159 12.7198 94.113 12.1081 94.5829 11.7526L96.673 10.1717Z" fill="#FFAD33" />
                                                </svg>
                                                </div> : product.stars === 4.5 ?
                                                    <div className="d-flex">
                                                        <svg width="100" height="20" viewBox="0 0 100 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M16.673 10.1717C17.7437 9.36184 17.1709 7.65517 15.8284 7.65517H13.3992C12.7853 7.65517 12.243 7.25521 12.0617 6.66868L11.3375 4.32637C10.9309 3.01106 9.0691 3.01106 8.66246 4.32637L7.93832 6.66868C7.75699 7.25521 7.21469 7.65517 6.60078 7.65517H4.12961C2.79142 7.65517 2.21592 9.35274 3.27822 10.1665L5.39469 11.7879C5.85885 12.1435 6.05314 12.7501 5.88196 13.3092L5.11296 15.8207C4.71416 17.1232 6.22167 18.1704 7.30301 17.342L9.14861 15.9281C9.65097 15.5432 10.349 15.5432 10.8514 15.9281L12.6807 17.3295C13.7636 18.159 15.2725 17.1079 14.8696 15.8046L14.09 13.2827C13.9159 12.7198 14.113 12.1081 14.5829 11.7526L16.673 10.1717Z" fill="#FFAD33" />
                                                            <path d="M36.673 10.1717C37.7437 9.36184 37.1709 7.65517 35.8284 7.65517H33.3992C32.7853 7.65517 32.243 7.25521 32.0617 6.66868L31.3375 4.32637C30.9309 3.01106 29.0691 3.01106 28.6625 4.32637L27.9383 6.66868C27.757 7.25521 27.2147 7.65517 26.6008 7.65517H24.1296C22.7914 7.65517 22.2159 9.35274 23.2782 10.1665L25.3947 11.7879C25.8588 12.1435 26.0531 12.7501 25.882 13.3092L25.113 15.8207C24.7142 17.1232 26.2217 18.1704 27.303 17.342L29.1486 15.9281C29.651 15.5432 30.349 15.5432 30.8514 15.9281L32.6807 17.3295C33.7636 18.159 35.2725 17.1079 34.8696 15.8046L34.09 13.2827C33.9159 12.7198 34.113 12.1081 34.5829 11.7526L36.673 10.1717Z" fill="#FFAD33" />
                                                            <path d="M56.673 10.1717C57.7437 9.36184 57.1709 7.65517 55.8284 7.65517H53.3992C52.7853 7.65517 52.243 7.25521 52.0617 6.66868L51.3375 4.32637C50.9309 3.01106 49.0691 3.01106 48.6625 4.32637L47.9383 6.66868C47.757 7.25521 47.2147 7.65517 46.6008 7.65517H44.1296C42.7914 7.65517 42.2159 9.35274 43.2782 10.1665L45.3947 11.7879C45.8588 12.1435 46.0531 12.7501 45.882 13.3092L45.113 15.8207C44.7142 17.1232 46.2217 18.1704 47.303 17.342L49.1486 15.9281C49.651 15.5432 50.349 15.5432 50.8514 15.9281L52.6807 17.3295C53.7636 18.159 55.2725 17.1079 54.8696 15.8046L54.09 13.2827C53.9159 12.7198 54.113 12.1081 54.5829 11.7526L56.673 10.1717Z" fill="#FFAD33" />
                                                            <path d="M76.673 10.1717C77.7437 9.36184 77.1709 7.65517 75.8284 7.65517H73.3992C72.7853 7.65517 72.243 7.25521 72.0617 6.66868L71.3375 4.32637C70.9309 3.01106 69.0691 3.01106 68.6625 4.32637L67.9383 6.66868C67.757 7.25521 67.2147 7.65517 66.6008 7.65517H64.1296C62.7914 7.65517 62.2159 9.35274 63.2782 10.1665L65.3947 11.7879C65.8588 12.1435 66.0531 12.7501 65.882 13.3092L65.113 15.8207C64.7142 17.1232 66.2217 18.1704 67.303 17.342L69.1486 15.9281C69.651 15.5432 70.349 15.5432 70.8514 15.9281L72.6807 17.3295C73.7636 18.159 75.2725 17.1079 74.8696 15.8046L74.09 13.2827C73.9159 12.7198 74.113 12.1081 74.5829 11.7526L76.673 10.1717Z" fill="#FFAD33" />
                                                            <path d="M89.9998 1.83329C89.7507 1.83145 89.5062 1.90032 89.2947 2.0319C89.0831 2.16348 88.9133 2.35236 88.8048 2.57662L86.9531 6.32995L82.8098 6.93162C82.5634 6.96713 82.3318 7.07094 82.1413 7.23129C81.9508 7.39163 81.809 7.60212 81.732 7.83889C81.655 8.07567 81.6458 8.32929 81.7055 8.57101C81.7652 8.81274 81.8914 9.03292 82.0698 9.20662L85.0698 12.1283L84.3615 16.255C84.3193 16.5001 84.3466 16.7521 84.4402 16.9825C84.5338 17.213 84.69 17.4126 84.8911 17.559C85.0922 17.7053 85.3302 17.7925 85.5783 17.8106C85.8264 17.8287 86.0745 17.7771 86.2948 17.6616L89.9998 15.7133V1.83329Z" fill="#FFAD33" />
                                                            <path opacity="0.25" d="M90 1.83595C90.2492 1.83404 90.5001 2.00001 90.5001 2.00001C90.5001 2.00001 91.0866 2.20807 91.1951 2.44195L93.0468 6.35634L97.1902 6.98383C97.4366 7.02086 97.6682 7.12912 97.8587 7.29635C98.0492 7.46358 98.191 7.68309 98.268 7.93003C98.345 8.17697 98.3542 8.44147 98.2945 8.69357C98.2348 8.94567 98.1086 9.1753 97.9302 9.35645L94.9301 12.4035L95.6385 16.7072C95.6806 16.9629 95.6533 17.2257 95.5598 17.466C95.4662 17.7064 95.31 17.9146 95.1089 18.0672C94.9077 18.2198 94.6697 18.3107 94.4216 18.3296C94.1736 18.3486 93.9254 18.2947 93.7051 18.1743L90 16.1423V1.83595Z" fill="black" />
                                                        </svg>

                                                    </div> :
                                                    <div className="d-flex">
                                                        <svg width="16" height="15" viewBox="0 0 16 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M14.673 7.17173C15.7437 6.36184 15.1709 4.65517 13.8284 4.65517H11.3992C10.7853 4.65517 10.243 4.25521 10.0617 3.66868L9.33754 1.32637C8.9309 0.0110567 7.0691 0.0110564 6.66246 1.32637L5.93832 3.66868C5.75699 4.25521 5.21469 4.65517 4.60078 4.65517H2.12961C0.791419 4.65517 0.215919 6.35274 1.27822 7.16654L3.39469 8.78792C3.85885 9.1435 4.05314 9.75008 3.88196 10.3092L3.11296 12.8207C2.71416 14.1232 4.22167 15.1704 5.30301 14.342L7.14861 12.9281C7.65097 12.5432 8.34903 12.5432 8.85139 12.9281L10.6807 14.3295C11.7636 15.159 13.2725 14.1079 12.8696 12.8046L12.09 10.2827C11.9159 9.71975 12.113 9.10809 12.5829 8.75263L14.673 7.17173Z" fill="#FFAD33" />
                                                        </svg>
                                                        <svg width="16" height="15" viewBox="0 0 16 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M14.673 7.17173C15.7437 6.36184 15.1709 4.65517 13.8284 4.65517H11.3992C10.7853 4.65517 10.243 4.25521 10.0617 3.66868L9.33754 1.32637C8.9309 0.0110567 7.0691 0.0110564 6.66246 1.32637L5.93832 3.66868C5.75699 4.25521 5.21469 4.65517 4.60078 4.65517H2.12961C0.791419 4.65517 0.215919 6.35274 1.27822 7.16654L3.39469 8.78792C3.85885 9.1435 4.05314 9.75008 3.88196 10.3092L3.11296 12.8207C2.71416 14.1232 4.22167 15.1704 5.30301 14.342L7.14861 12.9281C7.65097 12.5432 8.34903 12.5432 8.85139 12.9281L10.6807 14.3295C11.7636 15.159 13.2725 14.1079 12.8696 12.8046L12.09 10.2827C11.9159 9.71975 12.113 9.10809 12.5829 8.75263L14.673 7.17173Z" fill="#FFAD33" />
                                                        </svg>
                                                        <svg width="16" height="15" viewBox="0 0 16 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M14.673 7.17173C15.7437 6.36184 15.1709 4.65517 13.8284 4.65517H11.3992C10.7853 4.65517 10.243 4.25521 10.0617 3.66868L9.33754 1.32637C8.9309 0.0110567 7.0691 0.0110564 6.66246 1.32637L5.93832 3.66868C5.75699 4.25521 5.21469 4.65517 4.60078 4.65517H2.12961C0.791419 4.65517 0.215919 6.35274 1.27822 7.16654L3.39469 8.78792C3.85885 9.1435 4.05314 9.75008 3.88196 10.3092L3.11296 12.8207C2.71416 14.1232 4.22167 15.1704 5.30301 14.342L7.14861 12.9281C7.65097 12.5432 8.34903 12.5432 8.85139 12.9281L10.6807 14.3295C11.7636 15.159 13.2725 14.1079 12.8696 12.8046L12.09 10.2827C11.9159 9.71975 12.113 9.10809 12.5829 8.75263L14.673 7.17173Z" fill="#FFAD33" />
                                                        </svg>
                                                        <svg width="16" height="15" viewBox="0 0 16 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M14.673 7.17173C15.7437 6.36184 15.1709 4.65517 13.8284 4.65517H11.3992C10.7853 4.65517 10.243 4.25521 10.0617 3.66868L9.33754 1.32637C8.9309 0.0110567 7.0691 0.0110564 6.66246 1.32637L5.93832 3.66868C5.75699 4.25521 5.21469 4.65517 4.60078 4.65517H2.12961C0.791419 4.65517 0.215919 6.35274 1.27822 7.16654L3.39469 8.78792C3.85885 9.1435 4.05314 9.75008 3.88196 10.3092L3.11296 12.8207C2.71416 14.1232 4.22167 15.1704 5.30301 14.342L7.14861 12.9281C7.65097 12.5432 8.34903 12.5432 8.85139 12.9281L10.6807 14.3295C11.7636 15.159 13.2725 14.1079 12.8696 12.8046L12.09 10.2827C11.9159 9.71975 12.113 9.10809 12.5829 8.75263L14.673 7.17173Z" fill="#FFAD33" />
                                                        </svg>
                                                    </div>
                                            }
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                    <div className="d-flex justify-content-center">
                        <Link to={"Products"} className="btn btn-danger btn-sm text-capitalize px-4 py-2">view all products</Link>
                    </div>
                </div>
            </div>
        </div >
    )
}
